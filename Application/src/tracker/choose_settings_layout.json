{ "defaults": {
    "font": {
        "size": 0.6,
        "align": "left"
    },
    "color":[225,225,225,255],
    "highlight_clr":[50,50,75],
    "window_color":[10,10,10],
    "vars":{
        "label_w":185,
        "element_w":"{min:1024:{-:{-:{window_size.x}:{label_w}}:100}}",
        "is_small_window":"{<:{element_w}:1020004}",
        "inside_label_w":"{+:{label_w}:10}",
        "textfield_w":"{max:100:{+:{element_w}:160}}",
        "machine_learning":"{equal:{global.detect_type}:yolo}",
        "label_offset":[15,-5],
        "label_origin":[0,0],
        "label_padding":[0,30,10,5],
        "ratio":"{max:{/:{window_size.x}:{video_size.x}}:{/:{window_size.y}:{video_size.y}}}",
        "bg_scale":"[{ratio},{ratio}]",
        "valid_pv_file":"{file_exists:{resulting_path}.pv}"
    }
  },
  "objects":[
    {
        "type":"video",
        "clickable":true,
        "path":"{if:{video_file}:{video_file}:gfx/welcome/ComfyUI_00032_717534771402803_wind_%1.4d.jpg}",
        "pos":"[{*:{window_size.x}:0.5},{*:{window_size.y}:0.5}]",
        "origin":[0.5,0.5],
        "blur":"{if:{hovered}:0.01:0.7}",
        "alpha":"{if:{hovered}:0.75:0.25}",
        "frame_seconds":0.25,
        "scale":"{bg_scale}"
    },
    {
    "type":"vlayout",
    "align":"left",
    "clickable":true,
    "line":"{if:{is_small_window}:[0,0,0,0]:[0,0,0,150]}",
    "fill":"{if:{is_small_window}:[0,0,0,0]:[0,0,0,50]}",
    "pos":"{if:{is_small_window}:[0,0]:[{*:{window_size.x}:0.5},20]}",
    "origin":"{if:{is_small_window}:[0,0]:[0.5,0]}",
    "pad":[20,0,0,5],
    "children":[
        { "type":"stext",
          "pad":[2,25,0,20],
          "max_size":"[{-:{element_w}:25},0]",
          "text":"<h2>Configuration</h2>\n<lightgray>Below are three sections where you can configure the input and output of your project as well as the detection and tracking settings. If you are unsure what to do, you can leave most default settings as they are.</lightgray>", 
          "font":{ "size":0.7 }
        },
        {
            "type":"hlayout",
            "pad":[2,-10,-36,0],
            "children":[
                {
                    "type":"hlayout",
                    "align":"center",
                    "origin":[0,0],
                    "clickable":true,
                    "pad":[-1,0,0,0],
                    "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                    "children":[
                        {
                            "type":"collection",
                            "fill":[20,20,20,220],
                            "clickable":true,
                            "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                            "size":[200,40],
                            "children":[
                                {
                                    "pos":[100,20],
                                    "origin":[0.5,0.5],
                                    "type":"stext",
                                    "text":"<sym>üóÅ</sym> Locations",
                                    "font":{
                                        "align":"center",
                                        "size":0.65
                                    }
                                }
                            ]
                        },
                        {
                            "type":"button",
                            "text":"<sym>üíª</sym> Detection",
                            "fill":[40,40,40,220],
                            "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                            "size":[200,40],
                            "font":{
                                "align":"center",
                                "size":0.65
                            },
                            "action": "change_layout:settings_layout"
                        },
                        {
                            "type":"button",
                            "text":"<sym>üêü</sym> Tracking",
                            "fill":[40,40,40,220],
                            "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                            "size":[200,40],
                            "font":{
                                "align":"center",
                                "size":0.65
                            },
                            "action": "change_layout:tracking_settings_layout"
                        }
                    ]
                }
            ]
        },
        {
            "type":"gridlayout",
            "vertical_clr":[0,0,0,0],
            "horizontal_clr":[10,50,80,140],
            "cellfillclr":[20,20,20,200],
            "pad":[10,0,10,0],
            "clickable":true,
            "halign":"left",
            "valign":"top",
            "children":[
                [
                    {
                        "type":"stext",
                        "text":"<h3><sym>üóÅ</sym></h3> Input\n<small><gray>This specifies the video source for your project.</gray></small>",
                        "font":{"size":0.75},
                        "origin":"{label_origin}", "pos":"{label_offset}",
                        "max_size":"[{label_w},0]",
                        "pad":"{label_padding}"
                    },
                    [{
                        "type":"vlayout",
                        "children":[
                            {
                                "type":"rect",
                                "fill":[0,0,0,0],
                                "size":[0,30]
                            },
                            {
                                "type":"hlayout",
                                "align":"top",
                                "children":[
                                    {
                                        "type":"settings",
                                        "var":"source",
                                        "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                        "list":{
                                            "line":[220,220,220,200],
                                            "fill":[25,25,25,220],
                                            "size":"[{element_w},200]",
                                            "font":{"size":0.6}
                                        },
                                        "size":"[{-:{element_w}:35},40]",
                                        "desc":"",
                                        "preview":{
                                            "font":{"size":0.5},
                                            "color":[125,125,125,125],
                                            "max_size":"[{-:{element_w}:300},80]",
                                            "fade_out":0
                                        }
                                    },
                                    {
                                        "type":"button",
                                        "text":"<sym>üóÅ</sym>",
                                        "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                        "size":[40,40],
                                        "pad":[1,0,0,0],
                                        "font":{
                                            "align":"center",
                                            "size":0.8,
                                            "style":"bold"
                                        },
                                        "action": "choose-file:source:{folder:{source}}:Videos:*.pv *.mp4 *.avi *.mov *.mkv *.flv *.wmv *.webm *.m4v *.mpg *.mpeg *.m2v *.m4v *.ts *.mts *.m2ts *.vob *.3gp *.3g2 *.asf *.ogv *.ogg *.rm *.rmvb *.divx *.xvid *.flv *.f4v *.h264 *.h265 *.hevc *.mxf *.m2p *.m2v *.m2t *.m2ts *.m4p *.m4v *.m4a *.m4b *.m4r *.m4v *.m4p *.m4a *.m4b *.m4r *.m4v *.m4p *.m4a *.m4b *.m4r *.m4v *.m4p *.m4a *.m4b *.m4r *.m4v *.m4p *.m4a *.m4b *.m4r *.m4v *.m4p *.m4a *.m4b *.m4r *.m4v *.m4p *.m4a *.m4b *.m4r"
                                    }
                                ]
                            },
                            {
                                "type":"gridlayout",
                                "pad":[0,5,5,0],
                                "halign":"left",
                                "children":[
                                    [
                                        {
                                            "type":"stext",
                                            "text":"<b>settings</b>",
                                            "font":{"size":0.5},
                                            "pos":[0,6]
                                        },
                                        {
                                            "type":"condition",
                                            "var":"{selected_source_exists}",
                                            "then": {
                                                "type":"button",
                                                "text":"<sym>‚Æû</sym> reload from this file",
                                                "click":"reload_selected_source",
                                                "fill":[50,90,50],
                                                "size":[150,30],
                                                "font":{"size":0.5}
                                            }
                                        },
                                        {
                                            "type":"button",
                                            "text":"<sym>‚Æû</sym> load settings from a file",
                                            "click":"choose-settings:{folder:{source}}",
                                            "fill":[50,90,50],
                                            "size":[180,30],
                                            "font":{"size":0.5}
                                        },
                                        {
                                            "type":"button",
                                            "text":"<sym>‚Æû</sym> reset settings",
                                            "click":"reset_settings",
                                            "fill":[50,90,50],
                                            "size":[125,30],
                                            "font":{"size":0.5}
                                        },
                                        {
                                            "type":"stext",
                                            "text":"<b>other sources:</b>",
                                            "font":{"size":0.5},
                                            "pos":[0,6]
                                        },
                                        {
                                            "type":"button",
                                            "text":"<sym>‚Æû</sym> webcam",
                                            "click":"set:source:webcam",
                                            "fill":[50,90,50],
                                            "size":[120,30],
                                            "font":{"size":0.5}
                                        }
                                    ]
                                ]
                            },
                            {
                                "type":"hlayout",
                                "pad":[0,20,10,-10],
                                "children":[
                                    {
                                        "type":"stext",
                                        "text":"<sym>üéû</sym> convert <c>[from,to]</c> frame:",
                                        "origin":"{label_origin}", "pos":[0,10]
                                    },
                                    {
                                        "type":"settings",
                                        "var":"video_conversion_range",
                                        "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                        "list":{
                                            "line":[220,220,220,200],
                                            "fill":[25,25,25,220],
                                            "size":"[{min:150:{element_w}},200]",
                                            "font":{"size":0.6}
                                        },
                                        "size":"[{min:150:{-:{element_w}:200}},40]",
                                        "desc":""
                                    }
                                ]
                            },
                            {
                                "type":"rect",
                                "fill":[0,0,0,0],
                                "size":[1,15]
                            }
                        ]
                    }]
                ],

                [
                    {
                        "type":"stext",
                        "text":"<h3><sym>‚û•</sym></h3> Output\n<small><gray>This determines where your results will go and what they will be called.</gray></small>",
                        "font":{"size":0.75},
                        "origin":[0,0], "pos":"{label_offset}",
                        "max_size":"[{label_w},0]",
                        "pad":"{label_padding}"
                    },
                    {
                        "type":"vlayout",
                        "children":[
                            {
                                "type":"rect",
                                "fill":[0,0,0,0],
                                "size":[0,30]
                            },
                            {
                                "type":"gridlayout",
                                "pad":[0,0,0,10],
                                "vertical_clr":[0,0,0,0],
                                "horizontal_clr":[10,50,80,0],
                                "cellfillclr":[60,60,60,150],
                                "celllineclr":[100,100,100,50],
                                "cellfillinterval":2,
                                "clickable":true,
                                "halign":"left",
                                "children":[
                                    [
                                        {
                                            "type":"stext",
                                            "text":"<sym>üóÅ</sym> directory",
                                            "line":[100,100,100,50],
                                            "pad":[10,10,10,10],
                                            "origin":"{label_origin}", "pos":[0,0]
                                        },
                                        {
                                            "type":"hlayout",
                                            "children":[
                                                {
                                                    "type":"settings",
                                                    "var":"output_dir",
                                                    "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                                                    "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                                    "list":{
                                                        "line":[220,220,220,200],
                                                        "fill":[25,25,25,220],
                                                        "size":"[{-:{element_w}:93},200]",
                                                        "font":{"size":0.6}
                                                    },
                                                    "size":"[{-:{-:{element_w}:98}:42},40]",
                                                    "desc":""
                                                },
                                                {
                                                    "type":"button",
                                                    "text":"<sym>üóÅ</sym>",
                                                    "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                                                    "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                                    "size":[40,40],
                                                    "pad":[1,0,0,0],
                                                    "font":{
                                                        "align":"center",
                                                        "size":0.8,
                                                        "style":"bold"
                                                    },
                                                    "action": "choose-folder:output_dir:{output_dir}"
                                                }
                                            ]
                                        }
                                    ],
                                    [
                                        {
                                            "type":"stext",
                                            "text":"<sym>üóÅ</sym> prefix",
                                            "pad":[10,10,10,10],
                                            "origin":"{label_origin}", "pos":[0,0]
                                        },
                                        {
                                            "type":"settings",
                                            "var":"output_prefix",
                                            "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,255]}",
                                            "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                            "size":"[{-:{element_w}:100},40]",
                                            "desc":""
                                        }
                                    ],
                                    [
                                        {
                                            "type":"stext",
                                            "text":"<sym>üóé</sym>  filename",
                                            "pad":[10,10,10,10],
                                            "origin":"{label_origin}", "pos":[0,0]
                                        },
                                        {
                                            "type":"settings",
                                            "var":"filename",
                                            "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                                            "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                                            "list":{
                                                "line":[220,220,220,200],
                                                "fill":[25,25,25,220],
                                                "size":"[{-:{element_w}:95},200]",
                                                "font":{"size":0.6}
                                            },
                                            "size":"[{-:{element_w}:100},40]",
                                            "desc":""
                                        }
                                    ]
                                ]
                            },

                            {
                                "type":"rect",
                                "fill":[0,0,0,0],
                                "size":[1,10]
                            }
                        ]
                    }
                ],
                [
                    {
                        "type":"stext",
                        "text":"<h3><sym>üóÅ</sym></h3> Summary\n<small><gray>The target location of your converted video file, and a summary of the settings you have chosen.</gray></small>",
                        "font":{"size":0.75},
                        "origin":"{label_origin}", "pos":"{label_offset}",
                        "max_size":"[{label_w},0]",
                        "pad":"{label_padding}"
                    },
                    {
                        "type":"vlayout",
                        "children":[
                            {
                                "type":"hlayout",
                                "pad":[0,30,20,20],
                                "align":"top",
                                "children":[
                                    {
                                        "type":"vlayout",
                                        "line":[100,100,100,50],
                                        "fill":[60,60,60,100],
                                        "name":"left_summary",
                                        "children":[
                                            {
                                                "type":"vlayout",
                                                "line":[100,100,100,50],
                                                "fill":[60,60,60,100],
                                                "children":[
                                                    {
                                                        "type":"rect",
                                                        "fill":[0,0,0,0],
                                                        "size":"[{+:5:{*:0.45:{element_w}}},0]"
                                                    },
                                                    {
                                                        "type":"stext",
                                                        "pad":[10,10,10,15],
                                                        "max_size":"[{*:0.4:{element_w}},0]",
                                                        "text":"{if:{resulting_path}:<sym>‚û•</sym> <c><cyan>{resulting_path}</cyan><lightgray>.pv</lightgray></c>:<sym>‚û•</sym> <gray>please select an input file first</gray>}"
                                                    }
                                                ]
                                            },
                                            {
                                                "type":"condition",
                                                "var":"{valid_pv_file}",
                                                "then":{
                                                    "type":"stext",
                                                    "fill":[0,0,0,0],
                                                    "pad":[10,20,10,20],
                                                    "max_size":"[{min:750:{*:0.45:{element_w}}},0]",
                                                    "text":"<cyan><sym>\u2713</sym> this pv file exists.</cyan> <i>you probably have converted this video before. select <c>track</c> below to skip segmentation and proceed to the tracking view right away.</i>\n\n{if:{file_exists:{resulting_path}.settings}:<cyan><sym>\u2713</sym> settings file exists.</cyan>:<orange><sym>üó∂</sym> configuration file <c>{shorten:{resulting_path}:30}.settings</c> does not exist yet</orange>}"
                                                },
                                                "else":{
                                                    "type":"stext",
                                                    "fill":[0,0,0,0],
                                                    "pad":[20,20,20,20],
                                                    "max_size":"[{min:600:{*:0.45:{element_w}}},0]",
                                                    "text":"<orange><sym>üó∂</sym> this file does not exist yet.</orange> <i>a preprocessing step is required. detection finds objects of interest in the input video stream before they can be tracked.</i>"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "type":"stext",
                                        "font":{"size":0.5},
                                        "fill":[0,0,0,0],
                                        "max_size":"[{min:750:{-:{*:0.6:{element_w}}:20}},{+:50:{at:1:{dimensions:left_summary}}}]",
                                        "text":"<h4><lightgray>Changed settings (subset)</lightgray></h4>\n{settings_summary}"
                                    }
                                ]
                            },
                            {
                                "type":"stext",
                                "pad":[0,0,0,20],
                                "max_size":"[{min:700:{element_w}},0]",
                                "text":"{if:{equal:{global.detect_type}:yolo}:'<b>using <cyan><c>machine learning</c></cyan> for detection</b>':'using <cyan><c>background subtraction</c></cyan> for detection.'}{if:{&&:{equal:{global.detect_type}:yolo}:{global.region_model}}:'\n<sym>‚û•</sym> region selection using <cyan><c>{shorten:{filename:{global.region_model}}:50}</c></cyan><sym> üûô</sym> {global.region_resolution}<i>px</i>':''}{if:{equal:{global.detect_type}:yolo}:'\n<sym>‚û•</sym> detection using <cyan><c>{shorten:{filename:{global.detect_model}}:50}</c></cyan><sym> üûô</sym> {global.detect_resolution}<i>px</i>':''}"
                            }
                        ]
                    }
                ]
            ]
        }
    ]},

    {
        "type":"collection",
        "fill":[20,20,20,150],
        "size":"[{window_size.x},55]",
        "origin":[0,1],
        "pos":"[0,{window_size.y}]",
        "clickable":true,
        "children":[

            {
                "type":"hlayout",
                "align":"center",
                "pad":[5,0,5,0],
                "pos":[10,8],
                "origin":[0,0],
                "children":[
                    {
                        "type":"settings",
                        "var":"",
                        "font":{"size":0.6,"align":"center"},
                        "fill":"{if:{||:{selected}:{hovered}}:[60,60,60,200]:[50,50,50,200]}",
                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,50]}",
                        "placeholder":"<sym>üîç</sym> Parameters",
                        "list":{
                            "line":[220,220,220,200],
                            "fill":[25,25,25,220],
                            "size":"[{max:350:{-:{element_w}:90}},300]"
                        },
                        "size":"[{max:350:{-:{element_w}:220}},40]",
                        "label":{
                            "font":{"size":0.6}
                        },
                        "color":[225,225,225],
                        "desc":"",
                        "highlight_clr":[75,75,75,255]
                    }
                ]
            },
        
            {
                "type":"hlayout",
                "align":"center",
                "pad":[5,0,5,0],
                "pos":"[{-:{window_size.x}:10},8]",
                "origin":[1,0],
                "children":[
                    {
                        "type":"button",
                        "text":"<sym>üõá</sym> Back to menu",
                        "fill":[40,40,40,220],
                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                        "size":[150,40],
                        "font":{
                            "align":"center",
                            "size":0.65
                        },
                        "action": "change_scene:'starting-scene'"
                    },
                    {
                        "type":"button",
                        "text":"<sym>‚≠Ø</sym> Reset",
                        "fill":[40,40,40,220],
                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                        "size":[100,40],
                        "font":{
                            "align":"center",
                            "size":0.65
                        },
                        "action": "reset_settings"
                    },
                    {
                        "type":"button",
                        "text":"Convert <sym>‚Æû</sym>",
                        "fill":[40,40,40,220],
                        "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                        "size":[100,40],
                        "font":{
                            "align":"center",
                            "size":0.65
                        },
                        "action": "convert"
                    },
                    {
                        "type":"condition",
                        "var":"{valid_pv_file}",
                        "then":{
                            "type":"button",
                            "text":"Track <sym>‚Æû</sym>",
                            "fill":[40,40,40,220],
                            "line":"{if:{||:{selected}:{hovered}}:[100,175,250,200]:[100,100,100,150]}",
                            "size":[100,40],
                            "font":{
                                "align":"center",
                                "size":0.65
                            },
                            "action": "track"
                        }
                    }
                ]
            }
        ]
    }
]}
